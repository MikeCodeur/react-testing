# mocker un module

### üí° mocker un module

## üìù Tes notes

Detaille ce que tu as appris ici `src/exercise/07.md`
ou¬†sur¬†une¬†page¬†[Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Il est parfois utile de mocker un module entier. Prenons l'exemple du module qui
permet d'avoir un hook pour le localstorage. avec `jest.mock` et
`mockImplementation` on peut redefinir l'impl√©mentation du module. exemple :

```jsx
import useLocalStorage from 'use-local-storage'
jest.mock('use-local-storage')

function useLocalStorageMock() {
  const state = React.useState([])
  return state
}
useLocalStorage.mockImplementation(useLocalStorageMock)
```

Autre exemple avec Axios

```jsx
// users.js
import axios from 'axios'

class Users {
  static all() {
    return axios.get('/users.json').then(resp => resp.data)
  }
}

export default Users
```

```jsx
// users.test.js
import axios from 'axios'
import Users from './users'

jest.mock('axios')

test('doit r√©cup√©rer les utilisateurs', () => {
  const users = [{name: 'Bob'}]
  const resp = {data: users}
  axios.get.mockResolvedValue(resp)

  // ou vous pouvez utiliser ce qui suit en fonction de votre cas d'utilisation :
  // axios.get.mockImplementation(() => Promise.resolve(resp))

  return Users.all().then(data => expect(data).toEqual(users))
})
```

üìë Le liens [vers la doc Jest](https://jestjs.io/fr/docs/mock-functions)

## Exercice

Dans cet exercice nous avons un composant `<GeoLoc />` qui utilise le module
`'react-use-geolocation'` qui lui m√™me fait appel √† des fonction de
g√©olocalisation non support√©es par `jsdom` comme :
`window.navigator.geolocation.getCurrentPosition`. Tu vas devoir mocker le
module `'react-use-geolocation'`

Comme dans notre composant nous allons mettre √† jour un state du hook utilis√©
par notre composant GeoLoc, il va falloir wrapper le `composant / setState` dans
`act()` pour √©viter l'erreur suivante ``

```jsx
Warning: An update to GeoLoc inside a test was not wrapped in act(...).
```

Regarde la documentation de
[act()](https://reactjs.org/docs/test-utils.html#act) de React et
[act dans testing library](https://testing-library.com/docs/react-testing-library/api/#act)

## Bonus

### 1. üöÄ Tester le cas non support√©

Le hook de localisation est de la forme suivante :

```jsx
const [position, error] = useCurrentPosition()
// plus loins
{
  error.message
}
```

Fais un test qui passe le state `error` en erreur avec un message _"la
g√©olocalisation est non support√©"._ pour cela cr√©√© un objet `fakeError` avec la
propri√©t√© message. et utilise `setValue` en passant `fakeError` . Teste dans
l'ordre

- `chargement` est dans le document
- changement du state error
- `chargement` n'est plus dans le document
- "la g√©olocalisation est non support√©" est dans le document

### 2. üöÄ Mocker axios

Le composant `import LoginSubmit from '../../components/loginSubmitAxios'` est
identique aux pr√©c√©dents exercice √† l'exception qu'il utilise `axios` pour les
requet√©s http. Mock axios pour les tests de ce composants

## üêú Feedback

Remplir le formulaire le
[formulaire de FeedBack.](https://go.mikecodeur.com/cours-react-avis?entry.1430994900=React%20Testing%20Module&entry.533578441=07%20mocker%20un%20module%20/%20function)
